"use strict";(self.webpackChunkdendro_docs=self.webpackChunkdendro_docs||[]).push([[883],{2302:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>d,contentTitle:()=>c,default:()=>u,frontMatter:()=>n,metadata:()=>i,toc:()=>l});var r=o(5893),s=o(1151);const n={sidebar_position:3,sidebar_label:"Worker nodes: AWS Batch"},c="Dendro Worker nodes on AWS Batch",i={id:"compute_resource/worker_aws_batch",title:"Dendro Worker nodes on AWS Batch",description:"Here we provide instructions for setting up your compute resource to run Dendro jobs in AWS Batch. First you will need to provision the base AWS Batch infrastructure using CDK. This includes IAM roles, VPC, Security Group, EC2 Launch Templates, Batch Compute Environments and Batch Job Queues. Next you will need to configure your compute resource controller to submit jobs to AWS Batch. Finally, when you submit jobs from the web interface, you must select aws_batch as the run method.",source:"@site/docs/compute_resource/worker_aws_batch.md",sourceDirName:"compute_resource",slug:"/compute_resource/worker_aws_batch",permalink:"/dendro-docs/docs/compute_resource/worker_aws_batch",draft:!1,unlisted:!1,editUrl:"https://github.com/dendro-docs/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/compute_resource/worker_aws_batch.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,sidebar_label:"Worker nodes: AWS Batch"},sidebar:"documentationSidebar",previous:{title:"Host a Compute Resource",permalink:"/dendro-docs/docs/compute_resource/host_compute_resource"},next:{title:"Worker nodes: Slurm",permalink:"/dendro-docs/docs/compute_resource/worker_slurm"}},d={},l=[{value:"Step 1. Provision base Batch infrastructure with CDK",id:"step-1-provision-base-batch-infrastructure-with-cdk",level:2},{value:"Step 2. Configure compute resource controller",id:"step-2-configure-compute-resource-controller",level:2},{value:"Step 3. Submit jobs",id:"step-3-submit-jobs",level:2}];function a(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h1,{id:"dendro-worker-nodes-on-aws-batch",children:"Dendro Worker nodes on AWS Batch"}),"\n",(0,r.jsx)(t.p,{children:"Here we provide instructions for setting up your compute resource to run Dendro jobs in AWS Batch. First you will need to provision the base AWS Batch infrastructure using CDK. This includes IAM roles, VPC, Security Group, EC2 Launch Templates, Batch Compute Environments and Batch Job Queues. Next you will need to configure your compute resource controller to submit jobs to AWS Batch. Finally, when you submit jobs from the web interface, you must select aws_batch as the run method."}),"\n",(0,r.jsx)(t.h2,{id:"step-1-provision-base-batch-infrastructure-with-cdk",children:"Step 1. Provision base Batch infrastructure with CDK"}),"\n",(0,r.jsx)(t.admonition,{title:"Prerequisites",type:"info",children:(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Python >= 3.9"}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html",children:"AWS CLI"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://docs.aws.amazon.com/cdk/latest/guide/cli.html",children:"AWS CDK Toolkit"})}),"\n",(0,r.jsxs)(t.li,{children:["Set up your AWS credentials, either by ",(0,r.jsx)(t.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html",children:"configuring the AWS CLI"})," or by ",(0,r.jsx)(t.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvars.html",children:"setting environment variables"}),"."]}),"\n"]})}),"\n",(0,r.jsx)(t.p,{children:"AWS CDK is a very convenient tool, it helps automate the provisioning of AWS infrastructure and organizes all created resources in a CloudFormation stack, which can be easily updated or deleted."}),"\n",(0,r.jsx)(t.p,{children:"Follow these steps if you're running Dendro CDK stack for the first time:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["clone the Dendro repository: ",(0,r.jsx)(t.code,{children:"git clone https://github.com/flatironinstitute/dendro.git"}),"."]}),"\n",(0,r.jsxs)(t.li,{children:["go to the directory: ",(0,r.jsx)(t.code,{children:"cd dendro/iac/aws_batch"}),"."]}),"\n",(0,r.jsxs)(t.li,{children:["run ",(0,r.jsx)(t.code,{children:"pip install -r requirements.txt"})," to install the required Python packages."]}),"\n",(0,r.jsxs)(t.li,{children:["run ",(0,r.jsx)(t.code,{children:"cdk bootstrap"})," to set up the CDK deployment infrastructure (CKDToolkit) in your AWS account. This only needs to be done once."]}),"\n",(0,r.jsxs)(t.li,{children:["run ",(0,r.jsx)(t.code,{children:"cdk deploy"})," to deploy the stack to your default AWS account/region."]}),"\n",(0,r.jsxs)(t.li,{children:["you will be prompted to confirm the deployment. Review the changes, then type ",(0,r.jsx)(t.code,{children:"y"})," and hit enter."]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"If deployment is successful, you will be able to see the stacks in the CloudFormation page in AWS console."}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{src:"https://github.com/flatironinstitute/dendro/assets/3679296/87ca6dcd-fe59-4afc-b64f-4fcc24b64f86",alt:"CloudFormation stacks"})}),"\n",(0,r.jsx)(t.p,{children:"Other useful CDK commands:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"cdk ls"})," - list all stacks in the app."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"cdk synth"})," to synthesize the CloudFormation template without deploying it."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"cdk diff"})," - compare deployed stack with current state."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"cdk destroy"})," - destroy the stack."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"cdk docs"})," - open CDK documentation."]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"step-2-configure-compute-resource-controller",children:"Step 2. Configure compute resource controller"}),"\n",(0,r.jsxs)(t.p,{children:["In your compute resource directory, open the ",(0,r.jsx)(t.code,{children:".dendro-compute-resource-node.yaml"})," file and set"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"AVAILABLE_JOB_RUN_METHODS: local,aws_batch\nDEFAULT_JOB_RUN_METHOD: aws_batch\n"})}),"\n",(0,r.jsx)(t.p,{children:"You can choose whether you also include the local run method, and you can choose which run method is the default."}),"\n",(0,r.jsxs)(t.p,{children:["After you have made these changes, you will need to restart the compute resource controller. First, stop the compute resource controller process by pressing ",(0,r.jsx)(t.code,{children:"Ctrl+C"})," in the terminal where it is running. Then, start the compute resource controller process again:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"dendro start-compute-resource\n"})}),"\n",(0,r.jsxs)(t.p,{children:["See ",(0,r.jsx)(t.a,{href:"/dendro-docs/docs/compute_resource/host_compute_resource",children:"hosting a compute resource"})," for more details."]}),"\n",(0,r.jsx)(t.h2,{id:"step-3-submit-jobs",children:"Step 3. Submit jobs"}),"\n",(0,r.jsxs)(t.p,{children:["When you submit jobs from the web interface, you must select ",(0,r.jsx)(t.strong,{children:"aws_batch"})," as the run method."]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"select aws batch",src:o(1732).Z+"",width:"516",height:"300"})})]})}function u(e={}){const{wrapper:t}={...(0,s.a)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},1732:(e,t,o)=>{o.d(t,{Z:()=>r});const r=o.p+"assets/images/aws_batch_select-f5238693a1eb5322a1422cc4f5654196.png"},1151:(e,t,o)=>{o.d(t,{Z:()=>i,a:()=>c});var r=o(7294);const s={},n=r.createContext(s);function c(e){const t=r.useContext(n);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),r.createElement(n.Provider,{value:t},e.children)}}}]);