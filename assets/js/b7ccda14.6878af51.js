"use strict";(self.webpackChunkdendro_docs=self.webpackChunkdendro_docs||[]).push([[5537],{4765:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>c,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var s=t(5893),o=t(1151);const r={sidebar_position:5,sidebar_label:"Dendro for developers"},i="Dendro for developers",l={id:"tutorial-basics/for_developers",title:"Dendro for developers",description:"Here are some notes for developers. This is not a complete guide, but it should help you get started. Please contact the authors if you have any questions. We are happy to accept questions and pull requests.",source:"@site/docs/tutorial-basics/for_developers.md",sourceDirName:"tutorial-basics",slug:"/tutorial-basics/for_developers",permalink:"/dendro-docs/docs/tutorial-basics/for_developers",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/tutorial-basics/for_developers.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5,sidebar_label:"Dendro for developers"},sidebar:"documentationSidebar",previous:{title:"REST API",permalink:"/dendro-docs/docs/tutorial-basics/about_the_api"},next:{title:"IaC: AWS Batch",permalink:"/dendro-docs/docs/tutorial-basics/iac_aws_batch"}},a={},d=[{value:"Running the Python tests (vscode action)",id:"running-the-python-tests-vscode-action",level:2},{value:"Using pyright vscode extension",id:"using-pyright-vscode-extension",level:2},{value:"Using flake8 vscode extension",id:"using-flake8-vscode-extension",level:2},{value:"Setup",id:"setup",level:2},{value:"Running a development frontend server without hosting a local API",id:"running-a-development-frontend-server-without-hosting-a-local-api",level:2},{value:"Running a development frontend server together with a local API",id:"running-a-development-frontend-server-together-with-a-local-api",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"dendro-for-developers",children:"Dendro for developers"}),"\n",(0,s.jsx)(n.p,{children:"Here are some notes for developers. This is not a complete guide, but it should help you get started. Please contact the authors if you have any questions. We are happy to accept questions and pull requests."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#developing-the-python-package",children:"Developing the Python package"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#developing-the-frontend",children:"Developing the frontend"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#about-the-api",children:"About the API"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#release-strategy",children:"Release strategy"})}),"\n"]}),"\n",(0,s.jsx)(n.h1,{id:"developing-the-python-package",children:"Developing the Python package"}),"\n",(0,s.jsx)(n.h2,{id:"running-the-python-tests-vscode-action",children:"Running the Python tests (vscode action)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Install dendro\ncd python\npip install -e .\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Install the dependencies needed for testing\npip install pytest pytest-asyncio pytest-cov pyright flake8\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Also install the dependencies for the API:\npip install -r requirements.txt\n"})}),"\n",(0,s.jsx)(n.p,{children:"In vscode:"}),"\n",(0,s.jsx)(n.p,{children:"Command palette => Run Task => Test"}),"\n",(0,s.jsx)(n.p,{children:"This will check formatting using flake8 (see below), will check typing using pyright (see below), and will use pytest to run the tests in python/tests."}),"\n",(0,s.jsx)(n.h2,{id:"using-pyright-vscode-extension",children:"Using pyright vscode extension"}),"\n",(0,s.jsx)(n.p,{children:"By default, vscode/pylance doesn't seem to pick up linter problems like this:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"def test1(a: str, b: str):\n    print(a)\n\ndef test2():\n    x = 23\n    test1(a=None, b=x)\n"})}),"\n",(0,s.jsx)(n.p,{children:"So you should install the pyright vscode extension (ms-pyright)."}),"\n",(0,s.jsx)(n.h2,{id:"using-flake8-vscode-extension",children:"Using flake8 vscode extension"}),"\n",(0,s.jsx)(n.p,{children:"Install the flake8 vscode extension."}),"\n",(0,s.jsx)(n.p,{children:"The rules being ignored are in .flake8"}),"\n",(0,s.jsxs)(n.p,{children:["You can run ",(0,s.jsx)(n.code,{children:"cd python && flake8 --config ../.flake8"})," to see the errors."]}),"\n",(0,s.jsx)(n.h1,{id:"developing-the-frontend",children:"Developing the frontend"}),"\n",(0,s.jsx)(n.h2,{id:"setup",children:"Setup"}),"\n",(0,s.jsx)(n.p,{children:"Install a modern version of nodejs (e.g. v18)."}),"\n",(0,s.jsxs)(n.p,{children:["Install yarn (",(0,s.jsx)(n.code,{children:"npm install -g yarn"}),")."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Install the dependencies\ncd dendro\nyarn install\n"})}),"\n",(0,s.jsx)(n.h2,{id:"running-a-development-frontend-server-without-hosting-a-local-api",children:"Running a development frontend server without hosting a local API"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"This is the simplest method if you are not working on the API."})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Run the development server without the API\nyarn dev\n\n# Then open http://localhost:5173/?deployed-api=1\n"})}),"\n",(0,s.jsxs)(n.p,{children:["It is important to use the ",(0,s.jsx)(n.code,{children:"deployed-api"})," query parameter, otherwise the frontend will attempt to connect to an API running on localhost:5172."]}),"\n",(0,s.jsx)(n.p,{children:"In order for all functionality to work, you will need to create a .env file in the root of the project with the following contents:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"VITE_PUBNUB_SUBSCRIBE_KEY=...\nVITE_GITHUB_CLIENT_ID=...\nVITE_DEFAULT_COMPUTE_RESOURCE_ID=...\n"})}),"\n",(0,s.jsx)(n.p,{children:"Contact the authors for the appropriate values of these environment variables."}),"\n",(0,s.jsx)(n.h2,{id:"running-a-development-frontend-server-together-with-a-local-api",children:"Running a development frontend server together with a local API"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use this method only if you are working on the API."})}),"\n",(0,s.jsx)(n.p,{children:"For this, you will need to"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Install the Python requirements as described above."}),"\n",(0,s.jsx)(n.li,{children:"Sign up for a vercel account"}),"\n",(0,s.jsx)(n.li,{children:"Install the vercel command-line client"}),"\n",(0,s.jsxs)(n.li,{children:["Set up the appropriate cloud services","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"S3 bucket"}),"\n",(0,s.jsx)(n.li,{children:"MongoDB database"}),"\n",(0,s.jsx)(n.li,{children:"PubNub account"}),"\n",(0,s.jsx)(n.li,{children:"GitHub OAuth app"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Set up the vercel app and configure the appropriate environment variables","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"OUTPUT_BUCKET_CREDENTIALS, OUTPUT_BUCKET_BASE_URL, OUTPUT_BUCKET_URI, GITHUB_CLIENT_SECRET, VITE_GITHUB_CLIENT_ID, ADMIN_USER_IDS, VITE_PUBNUB_SUBSCRIBE_KEY, PUBNUB_PUBLISH_KEY, MONGO_URI, VITE_DEFAULT_COMPUTE_RESOURCE_ID"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Run the development server with the API\nvercel dev\n"})}),"\n",(0,s.jsx)(n.h1,{id:"about-the-api",children:"About the API"}),"\n",(0,s.jsxs)(n.p,{children:["See ",(0,s.jsx)(n.a,{href:"/dendro-docs/docs/tutorial-basics/about_the_api",children:"./about_the_api.md"}),"."]}),"\n",(0,s.jsx)(n.h1,{id:"release-strategy",children:"Release strategy"}),"\n",(0,s.jsx)(n.p,{children:"This repo consists of two main components: the frontend and the Python package. The frontend may undergo frequent updates to enhance user experience and fix issues, while the Python package is expected to remain more stable."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Frontend deployment:"})}),"\n",(0,s.jsx)(n.p,{children:"Generally speaking the main branch should always correspond to the currently deployed frontend. However, deployment is triggered in a GitHub action whenever changes are made to package.json, which usually results from manually bumping the frontend version. This should be performed regularly as changes are made to the frontend."}),"\n",(0,s.jsxs)(n.p,{children:["I followed this guide with some modifications to set up the GitHub action: ",(0,s.jsx)(n.a,{href:"https://vercel.com/guides/how-can-i-use-github-actions-with-vercel",children:"https://vercel.com/guides/how-can-i-use-github-actions-with-vercel"})]}),"\n",(0,s.jsx)(n.p,{children:"A couple notes on creating the vercel_deploy.yaml. I found I needed to create the .vercel/project.json even though this step wasn't included in the guide. I had to trigger the build on vercel servers rather than building locally (as in the guide) in order to get the api to work."}),"\n",(0,s.jsx)(n.p,{children:"The repository secrets are: VERCEL_ORG_ID, VERCEL_PROJECT_ID, VERCEL_TOKEN"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Python package release:"})}),"\n",(0,s.jsx)(n.p,{children:"The main branch should also generally correspond to the currently deployed Python package on PyPI. However, deployment is triggered in a GitHub action whenever changes are made to python/dendro/version.txt, which results from manually bumping the version in this file. This should be performed regularly as changes are made within the python directory. Deployment will only occur if all CI tests pass. The GitHub action also adds a tag to the commit with the version number."})]})}function c(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>l,a:()=>i});var s=t(7294);const o={},r=s.createContext(o);function i(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);